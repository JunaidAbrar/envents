{% extends 'base.html' %}

{% block title %}Services - Envents{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <h1 class="text-3xl font-bold text-gray-700 mb-6">Event Services</h1>
    
    <div class="flex flex-col md:flex-row gap-6">
        <!-- Filters Sidebar -->
        <div class="md:w-1/4 bg-white p-4 rounded-lg shadow-sm">
            <h2 class="text-xl font-semibold mb-4">Filters</h2>
            
            <form method="get" action="{% url 'services:service_list' %}">
                <!-- Categories -->
                <div class="mb-6">
                    <h3 class="font-medium text-gray-700 mb-2">Categories</h3>
                    <ul class="space-y-2">
                        <li>
                            <a href="{% url 'services:service_list' %}" 
                               class="{% if not current_category %}text-indigo-600 font-medium{% else %}text-gray-600 hover:text-indigo-600{% endif %}">
                                All Categories
                            </a>
                        </li>
                        {% for category in categories %}
                        <li>
                            <a href="{% url 'services:service_list_by_category' category.slug %}" 
                               class="{% if current_category == category.slug %}text-indigo-600 font-medium{% else %}text-gray-600 hover:text-indigo-600{% endif %}">
                                {{ category.name }}
                            </a>
                        </li>
                        {% endfor %}
                    </ul>
                </div>
                
                <!-- Price Range -->
                <div class="mb-6">
                    <h3 class="font-medium text-gray-700 mb-2">Price Range</h3>
                    <div class="flex items-center space-x-2">
                        <input type="number" name="min_price" placeholder="Min" value="{{ min_price }}"
                               class="w-full border border-gray-300 rounded px-3 py-2 text-sm">
                        <span class="text-gray-500">to</span>
                        <input type="number" name="max_price" placeholder="Max" value="{{ max_price }}"
                               class="w-full border border-gray-300 rounded px-3 py-2 text-sm">
                    </div>
                </div>
                
                <button type="submit" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-medium py-2 px-4 rounded">
                    Apply Filters
                </button>
            </form>
        </div>
        
        <!-- Services List -->
        <div class="md:w-3/4">
            <!-- Sort Options -->
            <div class="flex justify-between items-center mb-6">
                <div>
                    <span class="text-gray-600">Showing {{ services.start_index }} - {{ services.end_index }} of {{ services.paginator.count }} services</span>
                </div>
                <div class="flex items-center">
                    <label class="mr-2 text-gray-600">Sort by:</label>
                    <select id="sort-select" onchange="updateSort(this.value)" 
                            class="border border-gray-300 rounded px-3 py-1 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        <option value="name" {% if sort == 'name' %}selected{% endif %}>Name</option>
                        <option value="price_asc" {% if sort == 'price_asc' %}selected{% endif %}>Price: Low to High</option>
                        <option value="price_desc" {% if sort == 'price_desc' %}selected{% endif %}>Price: High to Low</option>
                        <option value="rating" {% if sort == 'rating' %}selected{% endif %}>Top Rated</option>
                    </select>
                </div>
            </div>
            
            <!-- Services Grid -->
            {% if services %}
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                {% for service in services %}
                <div class="bg-white rounded-lg overflow-hidden shadow-md hover:shadow-lg transition duration-300">
                    <!-- Service Image -->
                    <div class="h-48 overflow-hidden">
                        {% if service.main_photo %}
                        <img src="{{ service.main_photo.image.url }}" alt="{{ service.name }}" class="w-full h-full object-cover">
                        {% else %}
                        <img src="https://images.unsplash.com/photo-1511795409834-ef04bbd61622?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80" 
                             alt="{{ service.name }}" class="w-full h-full object-cover">
                        {% endif %}
                    </div>
                    
                    <!-- Service Info -->
                    <div class="p-4">
                        <div class="flex justify-between items-start mb-2">
                            <h3 class="text-lg font-semibold text-gray-800">{{ service.name }}</h3>
                            <span class="bg-gray-100 text-gray-700 text-xs font-medium px-2 py-1 rounded">
                                {{ service.category.name }}
                            </span>
                        </div>
                        
                        <!-- Price -->
                        <div class="text-indigo-600 font-medium mb-2">
                            ${{ service.base_price }} <span class="text-gray-500 text-sm">{{ service.price_type }}</span>
                        </div>
                        
                        <!-- Rating -->
                        <div class="flex items-center mb-3">
                            <div class="flex text-yellow-400">
                                {% for i in "12345" %}
                                {% if forloop.counter <= service.reviews.all|length %}
                                <svg class="w-4 h-4 fill-current" viewBox="0 0 24 24">
                                    <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"></path>
                                </svg>
                                {% else %}
                                <svg class="w-4 h-4 fill-current text-gray-300" viewBox="0 0 24 24">
                                    <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"></path>
                                </svg>
                                {% endif %}
                                {% endfor %}
                            </div>
                            <span class="text-gray-500 text-sm ml-1">
                                ({{ service.reviews.count }})
                            </span>
                        </div>
                        
                        <!-- Description (truncated) -->
                        <p class="text-gray-600 text-sm mb-4 line-clamp-2">{{ service.description|truncatechars:100 }}</p>
                        
                        <!-- Action button -->
                        <a href="{% url 'services:service_detail' service.slug %}" 
                           class="block w-full text-center bg-indigo-600 hover:bg-indigo-700 text-white font-medium py-2 px-4 rounded transition duration-300">
                            View Details
                        </a>
                    </div>
                </div>
                {% endfor %}
            </div>
            
            <!-- Pagination -->
            {% if services.has_other_pages %}
            <div class="flex justify-center mt-8">
                <div class="flex space-x-1">
                    {% if services.has_previous %}
                    <a href="?page={{ services.previous_page_number }}{% if sort %}&sort={{ sort }}{% endif %}{% if min_price %}&min_price={{ min_price }}{% endif %}{% if max_price %}&max_price={{ max_price }}{% endif %}" 
                       class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50">
                        Previous
                    </a>
                    {% endif %}
                    
                    {% for i in services.paginator.page_range %}
                    {% if services.number == i %}
                    <span class="px-4 py-2 border border-indigo-600 rounded-md bg-indigo-600 text-white">{{ i }}</span>
                    {% else %}
                    <a href="?page={{ i }}{% if sort %}&sort={{ sort }}{% endif %}{% if min_price %}&min_price={{ min_price }}{% endif %}{% if max_price %}&max_price={{ max_price }}{% endif %}" 
                       class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50">
                        {{ i }}
                    </a>
                    {% endif %}
                    {% endfor %}
                    
                    {% if services.has_next %}
                    <a href="?page={{ services.next_page_number }}{% if sort %}&sort={{ sort }}{% endif %}{% if min_price %}&min_price={{ min_price }}{% endif %}{% if max_price %}&max_price={{ max_price }}{% endif %}" 
                       class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50">
                        Next
                    </a>
                    {% endif %}
                </div>
            </div>
            {% endif %}
            {% else %}
            <div class="bg-white p-8 rounded-lg shadow-sm text-center">
                <p class="text-gray-600">No services found matching your criteria.</p>
                <a href="{% url 'services:service_list' %}" class="text-indigo-600 hover:underline mt-2 inline-block">Clear filters</a>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<script>
    function updateSort(value) {
        const url = new URL(window.location.href);
        url.searchParams.set('sort', value);
        window.location.href = url.toString();
    }
</script>
{% endblock %}